# Agent Handoff Spec – 방탈출 리뷰 앱 (v1)

> 목적: **다른 개발 에이전트가 해석 없이 구현 가능한 단일 진실 소스(SSOT)**
> 범위: v1 MVP (iOS/Android, 지인용)

---

## 0. TL;DR (Quick Start)
- 한 줄 정의: **내 방탈출 기록장**
- 플랫폼: iOS / Android (웹 기반 + 앱 패키징)
- 리뷰 유니크: **방(테마)당 사용자 1개 리뷰 (DB 강제)**
- 기본 공개: **그룹 전체 공개**
- 링크 공유: **v1 포함 / 로그인 필요 / `/share/:token`**
- 태그: **고정 태그 12개 + 기타 1개 직접 입력**

---

## 1. PRD (Product Requirements)

### 1.1 문제 정의
- 방탈출 경험은 누적되지만 기억은 흐려짐
- 기존 플랫폼은 광고/랭킹 위주로 개인 기록에 과함
- 지인끼리만 참고할 수 있는 정제된 기록 도구 필요

### 1.2 목표
- 플레이 직후 **1~2분 내 리뷰 기록**
- 나중에 다시 봐도 **방 간 비교가 쉬움**
- 불특정 다수가 아닌 **지인 그룹 공유**

### 1.3 비목표(v1)
- 공개 랭킹, 댓글/좋아요, 예약/결제 연동

### 1.4 성공 기준
- 리뷰 작성 완료율 ≥ 90%
- 링크 공유 열람 성공률 ≥ 99%

---

## 2. APP_FLOW (화면/UX 플로우)

### 2.1 라우트
- `/` : 리뷰 목록
- `/review/new` : 리뷰 작성
- `/review/:id` : 리뷰 상세
- `/room/search` : 방 검색/등록
- `/share/:token` : 링크 공유 열람 (로그인 필요)

### 2.2 리뷰 목록
- 노출: **총평 별점 + 한줄평 + 업체/테마 + 지역**
- 필터 우선순위: **지역, 평점**

### 2.3 리뷰 작성 UX
- 상단: 총평 별점(필수) + 한줄평(100자)
- 중단(접힘): 보조 지표 6개(1~5)
- 하단: 방문 메타 / 본문 / 사진
- 기본 공개: 그룹 전체

---

## 3. REVIEW_FORM_SPEC (작성 스펙)

### 3.1 요약(필수)
- 총평 별점: 1~5
- 한줄평: ≤100자

### 3.2 보조 지표(1~5)
- 퍼즐 퀄리티
- 스토리/연출
- 장치/세트 퀄리티
- 공포도
- 퍼즐 난이도
- 클리어 난이도

### 3.3 방문 메타
- 성공/실패 (필수)
- 남은 시간(분) (선택)
- 인원 수 (필수)
- 장르/테마: 고정 태그 멀티 + 기타 1개
- 재방문 의사 (Yes/No)

### 3.4 본문/미디어
- 본문: ≤3000자
- 사진: 1~3장 (선택, 강유도)

---

## 4. DATA_MODEL (요약)

### 4.1 핵심 제약
- `reviews` unique: **(user_id, room_id)**
- `rooms` unique: **(vendor_name, theme_name, region)**

### 4.2 태그(고정)
- 공포, 감성, 추리, 스릴러, 코믹, 액션,
- 잠입/미션, 판타지, 어드벤처, 미스터리, 드라마, SF
- + `custom_genre` 1개

---

## 5. SECURITY_RLS (정책 요약)

- 작성자: 리뷰 CRUD 가능
- 그룹 멤버: `visibility=group` 조회 가능 — v1 구현: `auth.uid() IS NOT NULL` (로그인 사용자 전체)
- private: 작성자만
- link: **로그인 사용자만 / RPC로 조회**

---

## 6. LINK_SHARING

- URL: **`/share/:token`**
- 동작:
  1. 리뷰 `visibility=link` 전환 시 `share_token` 발급
  2. 링크 접근 → 로그인 확인
  3. `get_shared_review(token)` RPC 호출

---

## 7. DECISIONS (결정 로그)

- 리뷰 단위: v1 방 단위 1개 (DB 강제)
- 재방문 가능성 낮음 → 방문 테이블 v1 제외
- 링크 공유 v1 포함 / 로그인 필요
- 태그는 시스템 고정 + 기타 1개
- v1 그룹 정의: **로그인한 전체 사용자 = 단일 전역 그룹** (초대 기반 아님). UI 라벨은 '회원 공개', DB 값은 `visibility='group'` 유지

---

## 8. HANDOFF CHECKLIST

- [x] Supabase DDL/RLS 적용 (PR #9)
- [x] 태그 시드 데이터 입력 (PR #9)
- [x] `/share/:token` 라우트 + RPC 연동 (PR #7, #9)
- [x] 리뷰 수정 권한 검증 — 본인만 수정 가능 (PR #10)
- [x] 작성자 이름 표시 — profiles 테이블 JOIN (PR #10)
- [x] 리뷰 작성 폼 유효성 검증 (PR #12)
- [x] 사진 업로드 / 실패 재시도 UX (PR #14)
- [x] 이메일/비밀번호 회원가입 및 로그인 (PR #15)
- [x] 모바일 iOS 자동 줌인 방지 (PR #16)
- [x] UI 리프레시 — 디자인 토큰, 컴포넌트 스타일, BaseSelect (PR #17)
- [x] 리뷰 작성 폼 멀티스텝 위자드 전환 (PR #17)
- [x] 인라인 방 등록 폼 (PR #17)
- [x] 리뷰 목록 통계 헤더 + CTA (PR #17)
- [x] RLS `reviews_group_select` → 로그인 사용자 전체 허용 (Supabase Dashboard 직접 수정)
- [x] 모바일 하단 탭바 전환 및 OG 메타태그 추가 (PR #18)

---

> 이 문서는 v1 기준 SSOT이며, 변경 시 DECISIONS 섹션에 기록 후 업데이트한다.
